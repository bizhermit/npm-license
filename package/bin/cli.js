#! /usr/bin/env node
"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const cli_utils_1=require("@bizhermit/cli-utils"),fs_1=require("fs"),path_1=__importDefault(require("path")),dist_1=__importDefault(require("../dist"));let returnMessage="";const main=()=>{const e=(0,cli_utils_1.hasKeyArg)("--quiet"),t=[],s=(0,cli_utils_1.getKeyArg)("-exclude");s&&s.split(",").forEach((e=>t.push(e)));const r=[],i=dist_1.default.collect({dirname:process.cwd(),includeDevDependencies:(0,cli_utils_1.hasKeyArg)("--dev"),includePrivate:(0,cli_utils_1.hasKeyArg)("--includePrivate")},r);if(null==i)return void r.forEach((t=>{e||process.stderr.write(`\nerr :: ${t.message}`),returnMessage+=`${t.message}\n`}));dist_1.default.validate({pkg:i,excludes:t},r),r.forEach((t=>{"info"!==t.type?"warn"!==t.type?(e||process.stderr.write(`\nerr :: ${t.message}`),returnMessage+=`${t.message}\n`):e||process.stdout.write(`\nwarn:: ${t.message}`):e||process.stdout.write(`\n#info:: ${t.message}`)})),(0,cli_utils_1.hasKeyArg)("--returnError")||(returnMessage="");const l=dist_1.default.format({pkg:i,format:(0,cli_utils_1.getKeyArg)("-f"),includeRoot:(0,cli_utils_1.hasKeyArg)("--includeRoot"),all:(0,cli_utils_1.hasKeyArg)("--outputAll")}),u=(0,cli_utils_1.getKeyArg)("-o");null!=u?(l.length>0||(0,cli_utils_1.hasKeyArg)("--outputForce"))&&(0,fs_1.writeFileSync)(path_1.default.join(process.cwd(),u),l):e||process.stdout.write("\n"+l+"\n")};if(main(),returnMessage)throw new Error("\n"+returnMessage);